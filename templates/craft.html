<html lang="en-us">

<head>
    <meta charset="utf-8">
    <title>WeboPy</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!--CSS-->
    <link rel="stylesheet" type="text/css" href="/static/css/generalDesign.css">
    <link rel="stylesheet" type="text/css" href="/static/css/craft.css">

    <!-- Unity -->
    <script src="/static/js/unityRelated/EssentialUnity.js"></script>
    <script src="/static/js/unityRelated/Build/UnityLoader.js"></script>

    <script>
        var gameInstance = UnityLoader.instantiate("gameContainer", "/static/js/unityRelated/Build/WebGLRoPE.json");
    </script>
    <script src="/static/js/craft.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lazyload@2.0.0-rc.2/lazyload.min.js"></script>

    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
</head>

<body style="background-color: black;-webkit-user-select: none; -khtml-user-select: none; -ms-user-select: none; -moz-user-select: none; user-select: none;"
      onselectstart="return false;">
      <div id="hidden-sp">
        <div class="actHopup">
            <p class="contentHopup"></p>
        </div>
    
    
        <div id="gameContainer" class="GameScreen"></div>
        <div class="GameWindow">
            <div class="tab-wrap">
            {%for kind in parts %}
                <input id="{{kind[0]}}" type="radio" name="TAB" class="tab-switch" checked="checked" /><label class="tab-label" for="{{kind[0]}}">{{kind[0]}}</label>
                <div class="tab-content">
                    {% for part in kind[1] %}
                    {% if part[2] == 'True' %}
                    <div class="partDes" onclick="PS('{{part[0]}}')">
                        <img class="partimage lazyload" type="image" src="/static/img/PartImage/{{part[0]}}.png" alt="CLUSTER SEO">
                        <h2 class="partNam">{{part[1]}}</h2>
                    </div>
                    {%else%}
                    <div class="partDes" onclick="" style="background-color: gray;color: white;">
                        <img class="partimage lazyload" type="image" src="/static/img/PartImage/{{part[0]}}.png" alt="CLUSTER SEO">
                        <h2 class="partNam">{{part[1]}}</h2>
                    </div>
                    {%endif%}
                    {%endfor%}
                </div>
            {%endfor%}
            </div>
        </div>
    
        <div class="LTicons">
            
            
            <input class="icon" type="image" src="/static/img/svg/arrow.svg" onclick="Back();">
            <input class="icon" type="image" src="/static/img/svg/save.svg" name="save" onclick="SaveRobot();Hopup('Save');">
            <input class="icon" type="image" src="/static/img/svg/load.svg" onclick="openSelect()">
            <input class="icon" type="image" src="/static/img/svg/eye.svg" onclick="gameInstance.SendMessage('GameDirector','ModuleVisualizer');">
            <input class="icon" id="run" type="image" src="/static/img/svg/mission.svg" onclick="toTest();">
            <input class="icon" type="image" src="/static/img/svg/program.svg" onclick="toProgram();">
        </div>
        <input class="icon" type="image" style="position: absolute;margin-top: 87vh;margin-left: 73vw;" src="/static/img/svg/eraser.svg" onclick="onClickButton('Remove')">
        
        <div class="selectBack">
        <div class="selectWindow">
            <div class="selectTab">
                {%if session['ver'] == 'pro'%}
                <a class="close" id="remove" style="float : left;"onclick='ToRemove()'>remove</a>
                <a class="close" style="float : left;"onclick='newRobot();'>new</a>
                {%endif%}
                <a class="close" onclick='$(".selectContent").empty();$(".selectBack").hide();'>close</a>
            </div>
            
            <div class="selectContent">
    
            </div>
        </div>
        </div>
        {%if session['ver'] == 'pro'%}
        <input type="text" class="robotName" value="Robot">
        {%else%}
        <input type="text" class="robotName" value="Robot" readonly>
        {%endif%}
        
    
        <script src="/static/js/node_modules/jquery/dist/jquery.min.js"></script>
        
        <script>
    
            lazyload();
            function PS(str) {
                gameInstance.SendMessage('GameDirector', 'PS', str);
            }
            
            function Back() {
                rn = $(".robotName").val();
                if(rn){
                    localStorage.setItem("lastRobot",rn);
                }else{
                    localStorage.setItem("lastRobot","robo3");
                }
                
                onClickButton("SaveJson");
                history.back();
            }
            function toMission(){
                rn = $(".robotName").val();
                if(rn){
                    localStorage.setItem("lastRobot",rn);
                }else{
                    localStorage.setItem("lastRobot","robo3");
                }
                
                onClickButton("SaveJson");
                location.href = {{url_for('missionSelect')|tojson}}
            }
            function toTest(){
                rn = $(".robotName").val();
                if(rn){
                    localStorage.setItem("lastRobot",rn);
                }else{
                    localStorage.setItem("lastRobot","robo3");
                }
                
                onClickButton("SaveJson");
                location.href = {{url_for('mission')|tojson}}+"?m=test"
            }
            function toProgram(){
                rn = $(".robotName").val();
                if(rn){
                    localStorage.setItem("lastRobot",rn);
                }else{
                    localStorage.setItem("lastRobot","robo3");
                }
                
                onClickButton("SaveJson");
                location.href = {{url_for('program')|tojson}}
            }
    
            $(document).ready(function() {
                $(window).keydown(function(event) {
                    var code = (event.keyCode ? event.keyCode : event.which);
                    if (!(code == 83 && event.ctrlKey)) return true;
                    event.preventDefault();
                    $('input[name="save"]').click();
                    return false;
                });
            });
    
            function SaveRobot(){
                onClickButton('SaveJson');
                rn = "R_" + $(".robotName").val();
                rnd = localStorage.getItem("robo3");
                localStorage.setItem(rn,rnd);
                localStorage.setItem("lastRobot",$(".robotName").val());
                Hopup('Save');
            }
            function newRobot(){
                onClickButton("ReLoad");
                closeSelect();
                localStorage.setItem("robo3","");
                localStorage.setItem("lastRobot","Robot");
                $(".robotName").val("Robot");
            }
            function openSelect(){
                $(".selectBack").fadeIn("slow");
                $(".selectContent").empty();
                for(key in localStorage){
                    if(key.indexOf("R_") === 0){
                        rn = key.substr(2);
                        $(".selectContent").append(`<a onclick="attachRobot('`+key+`')" class="selectbtn">` + rn +`</a>`)
                    }
                }
            }
            function closeSelect(){
                $(".selectContent").empty();
                $(".selectBack").fadeOut("slow");
            }
            function attachRobot(key){
                rnd = localStorage.getItem(key);
                localStorage.setItem('robo3',rnd);
                rn = key.substr(2);
                $(".robotName").val(rn);
                closeSelect();
                setTimeout(function(){
                    //onClickButton('ReLoad');
                },100); 
    
                setTimeout(function(){
                    onClickButton('LoadJson');
                },200);
            }
            function ToRemove(){
                $(".selectContent").empty();
                $("#remove").css('color','red');
                for(key in localStorage){
                    if(key.indexOf("R_") === 0){
                        rn = key.substr(2);
                        $(".selectContent").append(`<a onclick="removeRobot('`+key+`')" class="selectbtn">` + rn +`</a>`);
                    }
                }
            }
            function removeRobot(key){
                localStorage.removeItem(key);
                $("#remove").css('color','gray');
                $(".selectContent").empty();
                for(key in localStorage){
                    if(key.indexOf("R_") === 0){
                        rn = key.substr(2);
                        $(".selectContent").append(`<a onclick="attachRobot('`+key+`')" class="selectbtn">` + rn +`</a>`);
                    }
                }
            }
    
            function PartSwipe(){
                alert("swipe");
            }
            $(".tab-content").on('swipe',PartSwipe);
        </script>
        <script src="/static/js/generalJS.js"></script>
      </div>
      <div id="hidden-pc">
        <h1>ごめんなさい！</h1>
        <p>スマートフォンは対応していません！</p>
        <p>PCおよびiPadよりプレイしてみてくださいm(__)m</p>
      </div>

</body>

</html>





